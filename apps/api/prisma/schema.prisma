generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  runtime = "nodejs"
 
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  createdAt DateTime @default(now())
  role      UserRole @default(MEMBER)
}

model Patient {
  id        String           @id @default(cuid())
  name      String
  cpf       String           @unique
  phone     String           @unique
  birthDate DateTime
  createdAt DateTime         @default(now())
  codes     ActivationCode[]
  auth      PatientAuth?
}

model PatientAuth {
  id           String   @id @default(cuid())
  patientId    String   @unique
  passwordHash String?
  isActive     Boolean  @default(false)
  createdAt    DateTime @default(now())
  patient      Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model ActivationCode {
  id        String    @id @default(cuid())
  code      String    @unique
  patientId String
  createdAt DateTime  @default(now())
  expiresAt DateTime?
  usedAt    DateTime?
  patient   Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@index([code, usedAt])
}







enum UserRole {
  MEMBER
  ADMIN
}
